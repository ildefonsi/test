# --- Etapa 1: Build ---
FROM node:18-alpine as build

# Set the working directory
WORKDIR /app

# Copia los archivos de manifiesto primero para aprovechar el cache de Docker
COPY package.json ./
COPY package-lock.json ./ 

# Instala TODAS las dependencias (dependencies y devDependencies)
RUN npm install

# Ahora copia el resto del codigo fuente
COPY . .

# Construye la aplicacion (ahora tendra las herramientas que necesita)
RUN npm run build

# --- Etapa 2: Production ---
FROM nginx:alpine

# Copia los archivos estaticos construidos desde la etapa 'build'
COPY --from=build /app/build /usr/share/nginx/html

# Copia la configuraciï¿½n de Nginx
COPY nginx.conf /etc/nginx/nginx.conf

# Expone el puerto y arranca Nginx
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
